spring:
  main:
    allow-bean-definition-overriding: true

  datasource:
    url: jdbc:h2:mem:testdb;MODE=PostgreSQL;DATABASE_TO_LOWER=TRUE;DEFAULT_NULL_ORDERING=HIGH
    username: sa
    password:
    driver-class-name: org.h2.Driver

  jpa:
    hibernate:
      ddl-auto: validate  # Flyway manages schema in tests too
    show-sql: true

  flyway:
    enabled: true
    locations: classpath:db/migration
    validate-on-migrate: true

  # Task execution configuration for tests - disable wait on shutdown to prevent hanging
  task:
    execution:
      shutdown:
        await-termination: false
    scheduling:
      shutdown:
        await-termination: false

  # OAuth2 Resource Server configuration for tests
  security:
    oauth2:
      resourceserver:
        jwt:
          issuer-uri: https://test-issuer.example.com/
          audiences:
            - https://test-api.example.com

# Minimal CSV config for test context - tests should mock/stub as needed
budgetanalyzer:
  transaction-service:
    csv-config-map:
      test-bank:
        bank-name: "Test Bank"
        default-currency-iso-code: "USD"
        credit-header: "Credit"
        debit-header: "Debit"
        date-header: "Date"
        date-format: "MM/dd/uuuu"
        description-header: "Description"
